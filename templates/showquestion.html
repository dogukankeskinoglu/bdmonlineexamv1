<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Questions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.css')}}" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous">
    </script>

    <style>
        .soruicerik {
            background-color: white;
        }
    </style>
</head>

<body>
    <div id="exam" class="content">
        <h1>{{exam_id}}</h1>
        {% for i in sorular %} {% set outer_loop = loop.index-1 %} {% set question_no=loop.index %}
        <div class="soruicerik">
            <form action="">
                <h3>Soru {{question_no}}</h3>
                <p>{{i[2]}}</p>
                {% for k in i[3].split("*_*") %} {% set question_var = ['question', question_no, 'choice', loop.index]|join('_') %}
                <input type="radio" id={{question_var}} name={{question_no}}>
                <label for={{question_var}}></label>
                <label id=" questionlabel " +{{question_var}}>{{k}} </label>
                <p>{{question_var}}</p>
                {% endfor %}
            </form>
            <blockquote>Soru puanı:{{i[5]}}</blockquote>
        </div>
        {% endfor %}


    </div>
    <script>
        //Ogrenci_Soru(ogrenci_id INTEGER,soru_id INTEGER ,verilen_cevap CHAR(1) NOT NULL,aldigi_puan INTEGER NOT NULL")
        var exam_content = document.getElementById("exam")
        var exam = []
        var dogru_cevap_sık = 0;
        var soru_key = "";
        for (var i = 1; i < question_no; i++) {
            soru_key = "soru" + i;
            for (var k = 1; k < 6; k++) {
                if (document.getElementById("question" + i + "choice" + k).checked) {
                    dogru_cevap_sık = k;
                }
            }
            console.log(dogru_cevap_sık);
            console.log(soru_puan)
            console.log("**")
            var soru_val = {
                soru_id: question_content,
                verilen_cevap: dogru_cevap_sık,
            };
            exam.push({
                key: soru_key,
                value: soru_val
            })

            $.ajax({
                contentType: 'application/json;charset=UTF-8',
                url: "{{url_for('show_exams')}}",
                type: 'POST',
                data: JSON.stringify({
                    'data': exam
                }),
                success: function(response) {
                    alert("İşlem başarılı!");
                    window.location.href = "/exams";
                },
                error: function(error) {
                    alert("error");
                }
            });
        }
    </script>

</body>

</html>